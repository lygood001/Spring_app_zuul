<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>version page</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <!--CSS-->
    <link rel="stylesheet" href="../../plus/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../plus/WeAdmin/css/font.css">
    <link rel="stylesheet" href="../../plus/WeAdmin/css/weadmin.css">
  
    <script> 
        document.write("<script  src="+"../../plus/layui/jquery.min.js?"+Math.random()+"><"+"/"+"script>");
        document.write("<script  src="+"../../plus/layui/layui.all.js?"+Math.random()+"><"+"/"+"script>"); 
        document.write("<script  src="+"../../plus/mui/vue.min.js?"+Math.random()+"><"+"/"+"script>");
        document.write("<script  src="+"../../plus/WeAdmin/js/admin.js?"+Math.random()+"><"+"/"+"script>");
        document.write("<script  src="+"../../js/dms_bootweb_config.js?"+Math.random()+"><"+"/"+"script>");
        document.write("<script  src="+"../../js/dms_bootweb_common.js?"+Math.random()+"><"+"/"+"script>");
    </script>

</head> 
</head>

<body>
<form method="post" class="layui-form" id="editDealerItem" lay-filter="formEdit">
    <input id="id" name="id" type="hidden" th:value="${dealerDO.id}">
    <div class="layui-form-item layui-must-field">
        <label class="layui-form-label"><span>品牌名称</span></label>
        <div class="layui-input-block">
            <input id="inp_brand" name="vBrand" type="text" readonly="readonly" th:value="${dealerDO.vBrand}"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <label class="layui-form-label"><span>经销商代码</span></label>
        <div class="layui-input-block">
            <input id="inp_code" name="vCode" type="text" readonly="readonly" th:value="${dealerDO.vCode}"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <label class="layui-form-label"><span>经销商全称</span></label>
        <div class="layui-input-block">
            <input id="inp_full_name" name="vFullName" lay-verify="required" type="text" th:value="${dealerDO.vFullName}"
                   placeholder="请输入经销商全称"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">经销商简称</label>
        <div class="layui-input-block">
            <input id="vShortName" name="vShortName" type="text" th:value="${dealerDO.vShortName}"
                   placeholder="请输入经销商简称"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <label class="layui-form-label"><span>名称首字母</span></label>
        <div class="layui-input-block">
            <input id="vProfixer" name="vProfixer" type="text" lay-verify="required" th:value="${dealerDO.vProfixer}"
                   placeholder="请输入经销商名称首字母" autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <label class="layui-form-label"><span>控股投资人</span></label>
        <div class="layui-input-block">
            <input id="vInvestor" name="vInvestor" type="text" lay-verify="required" th:value="${dealerDO.vInvestor}" placeholder="请输入控股投资人"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <label class="layui-form-label"><span>开业时间</span></label>
        <div class="layui-input-block">
            <input id="dOpening" name="dOpening" type="text" lay-verify="required" th:value="${dealerDO.dOpening}" placeholder="请选择开业时间"
                   autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <div class="layui-form-item">
            <label class="layui-form-label"><span>大区</span></label>
            <div class="layui-input-block">
                <select name="vAreaCode" lay-verify="requiredd" id="selectArea" lay-filter="selectArea">
                    <option value="">请选择大区</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <div class="layui-form-item">
            <label class="layui-form-label"><span>省份</span></label>
            <div class="layui-input-block">
                <select id="selectProvince" name="vProvinceCode" lay-verify="requiredd" lay-filter="selectProvince">
                    <option value="">请选择省份</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item layui-must-field">
        <div class="layui-form-item">
            <label class="layui-form-label"><span>城市</span></label>
            <div class="layui-input-block">
                <select id="selectCity" name="vCityId" lay-verify="requiredd" lay-filter="selectCity">
                    <option value="">请选择城市</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-form-item">
            <label class="layui-form-label">4S店类型</label>
            <div class="layui-input-block">
                <select id="branchType" name="vBranchTypeCode" lay-filter="branchType">
                    <option value="">请选择4S店类型</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-form-item">
            <label class="layui-form-label">网络类型</label>
            <div class="layui-input-block">
                <select id="branchNetType" name="vBranchNetTypeCode" lay-filter="branchNetType">
                    <option value="">请选择网络类型</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-form-item">
            <label class="layui-form-label">经销商状态</label>
            <div class="layui-input-block">
                <select id="branchStatus" name="vBranchStatusCode" lay-filter="branchStatus">
                    <option value="">请选择经销商状态</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-form-item">
            <label class="layui-form-label">发展级形式</label>
            <div class="layui-input-block">
                <select id="developmentLevel" name="vDevelopmentLevelCode" lay-filter="developmentLevel">
                    <option value="">请选择发展级形式</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">地址</label>
        <div class="layui-input-block">
            <input id="vAdress" name="vAdress" type="text" th:value="${dealerDO.vAdress}" placeholder="请输入经销商地址"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">经度</label>
        <div class="layui-input-block">
            <input id="nLongitude" name="nLongitude" type="number" th:value="${dealerDO.nLongitude}"
                   placeholder="请输入经销商经度"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">纬度</label>
        <div class="layui-input-block">
            <input id="nLatitude" name="nLatitude" type="number" th:value="${dealerDO.nLatitude}" placeholder="请输入经销商纬度"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">销售电话</label>
        <div class="layui-input-block">
            <input id="vSalTel" name="vSalTel" type="tel" th:value="${dealerDO.vSalTel}" placeholder="请输入销售电话"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">服务电话</label>
        <div class="layui-input-block">
            <input id="vSvcTel" name="vSvcTel" type="tel" th:value="${dealerDO.vSvcTel}" placeholder="请输入服务电话"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">新车展位数</label>
        <div class="layui-input-block">
            <input id="nDisplayCount" name="nDisplayCount" type="number" th:value="${dealerDO.nDisplayCount}"
                   placeholder="请输入新车展位数"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">二手车授权</label>
        <div class="layui-input-block">
            <input id="vSHCFlag" name="vSHCFlag" type="checkbox" lay-skin="switch"
                   th:value="${dealerDO.vSHCFlag}" th:checked="${dealerDO.vSHCFlag}==0?'false':'ture'"
                   lay-text="已授权|未授权"
                   lay-filter="v_SHC_Flag">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">二手车授权时间</label>
        <div class="layui-input-block">
            <input id="dSHCAuth" name="dSHCAuth" type="text" th:value="${dealerDO.dSHCAuth}" placeholder="请选择二手车业务授权时间"
                   autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">A3 授权</label>
        <div class="layui-input-block">
            <input id="vA3ETron" name="vA3ETron" type="checkbox" lay-skin="switch"
                   th:value="${dealerDO.vA3ETron}" th:checked="${dealerDO.vA3ETron}==0?'false':'ture'"
                   lay-text="已授权|未授权"
                   lay-filter="a3AuthFlag">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">A6 授权</label>
        <div class="layui-input-block">
            <input id="vA6ETron" name="vA6ETron" type="checkbox" lay-skin="switch"
                   th:value="${dealerDO.vA6ETron}" th:checked="${dealerDO.vA6ETron}==0?'false':'ture'"
                   lay-text="已授权|未授权"
                   lay-filter="a6AuthFlag">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">Q7 授权</label>
        <div class="layui-input-block">
            <input id="vQ7ETron" name="vQ7ETron" type="checkbox" lay-skin="switch"
                   th:value="${dealerDO.vQ7ETron}" th:checked="${dealerDO.vQ7ETron}==0?'false':'ture'"
                   lay-text="已授权|未授权"
                   lay-filter="q7AuthFlag">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">Sport授权</label>
        <div class="layui-input-block">
            <input id="vSportETron" name="vSportETron" type="text" th:value="${dealerDO.vSportETron}" placeholder="请输入Audi Sprot授权"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-block">
            <input id="vRemark" name="vRemark" type="text" th:value="${dealerDO.vRemark}" placeholder="请输入备注"
                   autocomplete="off"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">创建者</label>
        <div class="layui-input-block">
            <input type="text" name="vCreatorName" id="vCreateName" th:value="${dealerDO.vCreatorName}"
                   autocomplete="off"
                   readonly="readonly" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">创建时间</label>
        <div class="layui-input-block">
            <input type="text" name="dCreate" id="dCreateDate" th:value="${dealerDO.dCreate}" autocomplete="off"
                   readonly="readonly"
                   class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="from_edit" type="submit">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>

<script>

    var form = layui.form
        , laydate = layui.laydate;
    var userInfo = getUserInfo();
    var vAreaCode = '',
        vProCode = '';
    laydate.render({
        elem: '#dOpening'
    });
    laydate.render({
        elem: '#dSHCAuth'
    });

    $(function () {
        initPageData();
        initPageEvent();
    });

    /**
     * 初始化列表数据
     */
    function initPageData() {
        //初始化列表数据
        form.val('formEdit', {})
        //加载品牌数据
        initBrandSelect();
        //加载4S店类型数据
        initBranchType();
        //加载经销商网络类型数据
        initBranchNetType();
        //加载经销商状态数据
        initBranchStatus();
        //加载发展级形式数据
        initDevelopmentLevel();

        $("#vCreateName").val(userInfo.vrealName);
        $("#dCreateDate").val(getDateFormatYYYY_MM_DD(new Date()));
    }

    /**
     * 初始化事件
     */
    function initPageEvent() {
        form.on('switch(v_SHC_Flag)', function (data) {
            if (data.elem.checked) {

            } else {
                $("#dSHCAuth").val('');
            }
        });

        //form提交事件
        form.on('submit(from_edit)', function (data) {
            if ($('input[name="vSHCFlag"]').is(':checked')) {
                data.field.vSHCFlag = "1";
            } else {
                data.field.vSHCFlag = "0";
            }
            if ($('input[name="vA3ETron"]').is(':checked')) {
                data.field.vA3ETron = "1";
            } else {
                data.field.vA3ETron = "0";
            }
            if ($('input[name="vA6ETron"]').is(':checked')) {
                data.field.vA6ETron = "1";
            } else {
                data.field.vA6ETron = "0";
            }
            if ($('input[name="vQ7ETron"]').is(':checked')) {
                data.field.vQ7ETron = "1";
            } else {
                data.field.vQ7ETron = "0";
            }
            // if ($('input[name="vSportETron"]').is(':checked')) {
            //     data.field.vSportETron = "1";
            // } else {
            //     data.field.vSportETron = "0";
            // }
            var urlStr = "/app/dealer/update";
            var jsonData = data.field;
            callAjax(urlStr, jsonData, function (jsonData, status) {
                if (jsonData.code == "S" && status == dms_boot_config.CALL_URL_OK) {
                    dmsalert('修改经销商信息成功!', 'S', function () {
                        window.parent.location.reload();//修改成功后刷新父界面
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    });
                } else {
                    dmsalert(jsonData.msg, "W");
                }
            });
            return false;
        });
    }

    /**
     *
     * 初始品牌下拉数据
     */
    function initBrandSelect() {
        //设置页面的品牌来源列表
        var urlStr = "/app/brand/getAllBrandList";
        callAjax(urlStr, {}, function (jsonData, status) {
            if (jsonData.code == 'S' && status == dms_boot_config.CALL_URL_OK) {
                var select_brand_obj = $("select[name='vBrand']");
                for (var i = 0; i < jsonData.data.length; i++) {
                    var opt = "<option value='" + jsonData.data[i].id + "'>" + jsonData.data[i].vBrandDesc + "</option>";
                    select_brand_obj.append(opt);
                }
                form.render('select');
                initAreaSelect();
            } else {
                dmstoast('获取品牌来源列表失败！', "W");
            }
        });
    }

    /**
     *
     * 初始大区下拉数据
     */
    function initAreaSelect() {
        //设置页面的大区来源列表
        callAjax("/app/area/getallarealist", {}, function (jsonData, status) {
            if (jsonData.code == 'S' && status == dms_boot_config.CALL_URL_OK) {
                var select_area_obj = $("select[name='vAreaCode']");
                for (var i = 0; i < jsonData.data.length; i++) {
                    if ([[${dealerDO.vAreaCode}]] == jsonData.data[i].vcode) {
                        var opt = "<option selected='selected' value='" + jsonData.data[i].vcode + "'>" + jsonData.data[i].vname + "</option>";
                        select_area_obj.append(opt);
                        continue;
                    }
                    var opt = "<option value='" + jsonData.data[i].vcode + "'>" + jsonData.data[i].vname + "</option>";
                    select_area_obj.append(opt);
                    vAreaCode = jsonData.data[0].vcode;
                }
                provinceSelect([[${dealerDO.vAreaCode}]]);
                form.render('select');
                form.on('select(selectArea)', function (data) {
                    vAreaCode = data.value;
                    provinceSelect(vAreaCode);
                });
            } else {
                dmstoast('获取大区来源列表失败！', "W");
            }
        });
    }

    //根据所选区域加载省份数据
    function provinceSelect(area_code) {
        var html = '';
        var select_province_obj = '';
        $('#selectProvince').html('');
        callAjax("/app/province/getProListByAreaCode", {vAreaCode: area_code}, function (jsonData, status) {
            if (jsonData.code == 'S' && status == dms_boot_config.CALL_URL_OK) {
                select_province_obj = $("select[name='vProvinceCode']");
                vProCode = jsonData.data[0].vProCode;
                for (var i = 0; i < jsonData.data.length; i++) {
                    if ([[${dealerDO.vProvinceCode}]] == jsonData.data[i].vProCode) {
                        html = "<option selected='selected' value='" + jsonData.data[i].vProCode + "'>" + jsonData.data[i].vProName + "</option>";
                        select_province_obj.append(html);
                        vProCode = [[${dealerDO.vProvinceCode}]];
                    }
                    html = "<option value='" + jsonData.data[i].vProCode + "'>" + jsonData.data[i].vProName + "</option>";
                    select_province_obj.append(html);
                }
                citySelect(vProCode);
                form.render('select');
                form.on('select(selectProvince)', function (data) {
                    vProCode = data.value;
                    citySelect(vProCode);
                });
            } else {
                dmstoast('根据大区获取省份数据失败！', "W");
            }
        });
    }

    //根据所选省份加载城市数据
    function citySelect(province_code) {
        var city_html = '';
        var select_city_obj = '';
        $('#selectCity').html('');
        callAjax("/app/city/getCityListByProCode", {vProCode: province_code}, function (jsonData, status) {
            if (jsonData.code == 'S' && status == dms_boot_config.CALL_URL_OK) {
                select_city_obj = $("select[name='vCityId']");
                for (var i = 0; i < jsonData.data.length; i++) {
                    if ([[${dealerDO.vCityId}]] == jsonData.data[i].id) {
                        city_html = "<option selected='selected' value='" + jsonData.data[i].id + "'>" + jsonData.data[i].vCityName + "</option>";
                        select_city_obj.append(city_html);
                        continue;
                    }
                    city_html = "<option value='" + jsonData.data[i].id + "'>" + jsonData.data[i].vCityName + "</option>";
                    select_city_obj.append(city_html);
                }
                form.render('select');
            } else {
                dmstoast('根据所选省份加载城市数据失败！', "W");
            }
        });
    }

    /**
     * 初始化4s店类型列表
     */
    function initBranchType() {
        callAjax("/app/dict/getDictItemForList", {"vDictCode": "branch_type"}, function (jsonData, status) {
            if (jsonData.code == "S" && status == dms_boot_config.CALL_URL_OK) {
                var str = "";
                for (var i = 0; i < jsonData.data.length; i++) {
                    if ('[[${dealerDO.vBranchTypeCode}]]' == jsonData.data[i].vCode) {
                        str += "<option selected='selected' value='" + jsonData.data[i].vCode + "'>" + jsonData.data[i].vDesc + "</option>";
                        continue;
                    } else {
                        str += "<option value='" + jsonData.data[i].vCode + "'>" + jsonData.data[i].vDesc + "</option>";
                    }
                }
                $("#branchType").append(str);
                form.render('select');
            } else {
                dmsalert(data.msg, "W");
            }
        });
    }

    /**
     * 初始化经销商网络类型列表
     */
    function initBranchNetType() {
        callAjax("/app/dict/getDictItemForList", {"vDictCode": "branch_net_type"}, function (jsonData, status) {
            if (jsonData.code == "S" && status == dms_boot_config.CALL_URL_OK) {
                var str1 = "";
                for (var i = 0; i < jsonData.data.length; i++) {
                    if ([[${dealerDO.vBranchNetTypeCode}]] == jsonData.data[i].vCode) {
                        str1 += "<option selected='selected' value='" + jsonData.data[i].vCode + "'>" + jsonData.data[i].vDesc + "</option>";
                        continue;
                    } else {
                        str1 += "<option value='" + jsonData.data[i].vCode + "'>" + jsonData.data[i].vDesc + "</option>";
                    }
                }
                $("#branchNetType").append(str1);
                form.render('select');
            } else {
                dmsalert(data.msg, "W");
            }
        });
    }

    /**
     * 初始化经销商状态列表
     */
    function initBranchStatus() {
        callAjax("/app/dict/getDictItemForList", {"vDictCode": "branch_status"}, function (data, status) {
            if (data.code == "S" && status == dms_boot_config.CALL_URL_OK) {
                var str2 = "";
                for (var i = 0; i < data.data.length; i++) {
                    if ([[${dealerDO.vBranchStatusCode}]] == data.data[i].vCode) {
                        str2 += "<option selected='selected' value='" + data.data[i].vCode + "'>" + data.data[i].vDesc + "</option>";
                    } else {
                        str2 += "<option value='" + data.data[i].vCode + "'>" + data.data[i].vDesc + "</option>"
                    }
                }
                $("#branchStatus").append(str2);
                form.render('select');
            } else {
                dmsalert(data.msg, "W");
            }
        });
    }

    /**
     * 初始化发展级形式列表
     */
    function initDevelopmentLevel() {
        callAjax("/app/dict/getDictItemForList", {"vDictCode": "branch_development_level"}, function (data, status) {
            if (data.code == "S" && status == dms_boot_config.CALL_URL_OK) {
                var str3 = "";
                for (var i = 0; i < data.data.length; i++) {
                    if ([[${dealerDO.vDevelopmentLevelCode}]] == data.data[i].vCode) {
                        str3 += "<option selected='selected' value='" + data.data[i].vCode + "'>" + data.data[i].vDesc + "</option>";
                    } else {
                        str3 += "<option value='" + data.data[i].vCode + "'>" + data.data[i].vDesc + "</option>";
                    }
                }
                $("#developmentLevel").append(str3);
                form.render('select');
            } else {
                dmsalert(data.msg, "W");
            }
        });
    }
</script>

</body>
</html>